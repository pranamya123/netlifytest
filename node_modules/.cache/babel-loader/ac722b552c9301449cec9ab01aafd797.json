{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = require(\"react\");\n\nvar react_dom_1 = require(\"react-dom\");\n\nvar util_1 = require(\"./util\");\n\nvar ArrowContainer_1 = require(\"./ArrowContainer\");\n\nexports.ArrowContainer = ArrowContainer_1.ArrowContainer;\n\nvar Portal_1 = require(\"./Portal\");\n\nvar underscore_1 = require(\"underscore\");\n\nvar Popover =\n/** @class */\nfunction (_super) {\n  __extends(Popover, _super);\n\n  function Popover(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.target = null;\n    _this.targetRect = null;\n    _this.targetPositionIntervalHandler = null;\n    _this.popoverDiv = null;\n    _this.positionOrder = null;\n    _this.willUnmount = false;\n    _this.willMount = false;\n\n    _this.onResize = function (e) {\n      _this.renderPopover();\n    };\n\n    _this.onClick = function (e) {\n      var _a = _this.props,\n          onClickOutside = _a.onClickOutside,\n          isOpen = _a.isOpen;\n\n      if (!_this.willUnmount && !_this.willMount && !_this.popoverDiv.contains(e.target) && !_this.target.contains(e.target) && onClickOutside && isOpen) {\n        onClickOutside(e);\n      }\n    };\n\n    _this.state = {\n      popoverInfo: null\n    };\n    _this.willUnmount = false;\n    _this.willMount = true;\n    return _this;\n  }\n\n  Popover.prototype.componentDidMount = function () {\n    var _this = this;\n\n    window.setTimeout(function () {\n      return _this.willMount = false;\n    });\n    var _a = this.props,\n        position = _a.position,\n        isOpen = _a.isOpen;\n    this.target = react_dom_1.findDOMNode(this);\n    this.positionOrder = this.getPositionPriorityOrder(position);\n    this.updatePopover(isOpen);\n  };\n\n  Popover.prototype.componentDidUpdate = function (prevProps) {\n    if (this.target == null) {\n      this.target = react_dom_1.findDOMNode(this);\n    }\n\n    var prevIsOpen = prevProps.isOpen,\n        prevPosition = prevProps.position,\n        prevBody = prevProps.content;\n    var _a = this.props,\n        isOpen = _a.isOpen,\n        content = _a.content,\n        position = _a.position;\n    this.positionOrder = this.getPositionPriorityOrder(this.props.position);\n    var hasNewDestination = prevProps.contentDestination !== this.props.contentDestination;\n\n    if (prevIsOpen !== isOpen || prevBody !== content || prevPosition !== position || hasNewDestination) {\n      if (hasNewDestination) {\n        this.removePopover();\n        this.popoverDiv && this.popoverDiv.remove();\n      }\n\n      this.updatePopover(isOpen);\n    }\n  };\n\n  Popover.prototype.componentWillUnmount = function () {\n    this.willUnmount = true;\n    this.removePopover();\n  };\n\n  Popover.prototype.render = function () {\n    var content = this.props.content;\n    var popoverInfo = this.state.popoverInfo;\n    var popoverContent = null;\n\n    if (this.props.isOpen && this.popoverDiv && popoverInfo) {\n      var getContent = function (args) {\n        return typeof content === 'function' ? content(args) : content;\n      };\n\n      popoverContent = React.createElement(Portal_1.Portal, {\n        element: this.popoverDiv,\n        container: this.props.contentDestination || window.document.body\n      }, getContent(popoverInfo));\n    }\n\n    return React.createElement(React.Fragment, null, this.props.children, popoverContent);\n  };\n\n  Popover.prototype.updatePopover = function (isOpen) {\n    if (isOpen && this.target != null) {\n      if (!this.popoverDiv || !this.popoverDiv.parentNode) {\n        var transitionDuration = this.props.transitionDuration;\n        this.popoverDiv = this.createContainer();\n        this.popoverDiv.style.opacity = '0';\n        this.popoverDiv.style.transition = \"opacity \" + (transitionDuration || util_1.Constants.FADE_TRANSITION) + \"s\";\n      }\n\n      window.addEventListener('resize', this.onResize);\n      window.addEventListener('click', this.onClick);\n      this.renderPopover();\n    } else if (this.popoverDiv && this.popoverDiv.parentNode) {\n      this.removePopover();\n    }\n  };\n\n  Popover.prototype.renderPopover = function (positionIndex) {\n    var _this = this;\n\n    if (positionIndex === void 0) {\n      positionIndex = 0;\n    }\n\n    if (positionIndex >= this.positionOrder.length) {\n      this.removePopover();\n      return;\n    }\n\n    this.renderWithPosition({\n      position: this.positionOrder[positionIndex],\n      targetRect: this.target.getBoundingClientRect()\n    }, function (violation, rect) {\n      var _a;\n\n      var _b = _this.props,\n          disableReposition = _b.disableReposition,\n          contentLocation = _b.contentLocation;\n\n      if (violation && !disableReposition && !(typeof contentLocation === 'object')) {\n        _this.renderPopover(positionIndex + 1);\n      } else {\n        var _c = _this.props,\n            contentLocation_1 = _c.contentLocation,\n            align = _c.align;\n\n        var _d = _this.getNudgedPopoverPosition(rect),\n            nudgedTop = _d.top,\n            nudgedLeft = _d.left;\n\n        var rectTop = rect.top,\n            rectLeft = rect.left;\n        var position = _this.positionOrder[positionIndex];\n\n        var _e = disableReposition ? {\n          top: rectTop,\n          left: rectLeft\n        } : {\n          top: nudgedTop,\n          left: nudgedLeft\n        },\n            top_1 = _e.top,\n            left = _e.left;\n\n        if (contentLocation_1) {\n          var targetRect = _this.target.getBoundingClientRect();\n\n          var popoverRect = _this.popoverDiv.getBoundingClientRect();\n\n          _a = typeof contentLocation_1 === 'function' ? contentLocation_1({\n            targetRect: targetRect,\n            popoverRect: popoverRect,\n            position: position,\n            align: align,\n            nudgedLeft: nudgedLeft,\n            nudgedTop: nudgedTop\n          }) : contentLocation_1, top_1 = _a.top, left = _a.left;\n          _this.popoverDiv.style.left = left.toFixed() + \"px\";\n          _this.popoverDiv.style.top = top_1.toFixed() + \"px\";\n        } else {\n          var destinationTopOffset = 0;\n          var destinationLeftOffset = 0;\n\n          if (_this.props.contentDestination) {\n            var destRect = _this.props.contentDestination.getBoundingClientRect();\n\n            destinationTopOffset = -destRect.top;\n            destinationLeftOffset = -destRect.left;\n          }\n\n          var _f = [top_1 + window.pageYOffset, left + window.pageXOffset],\n              absoluteTop = _f[0],\n              absoluteLeft = _f[1];\n          var finalLeft = absoluteLeft + destinationTopOffset;\n          var finalTop = absoluteTop + destinationLeftOffset;\n          _this.popoverDiv.style.left = finalLeft.toFixed() + \"px\";\n          _this.popoverDiv.style.top = finalTop.toFixed() + \"px\";\n        }\n\n        _this.popoverDiv.style.width = null;\n        _this.popoverDiv.style.height = null;\n\n        _this.renderWithPosition({\n          position: position,\n          nudgedTop: nudgedTop - rect.top,\n          nudgedLeft: nudgedLeft - rect.left,\n          targetRect: _this.target.getBoundingClientRect(),\n          popoverRect: _this.popoverDiv.getBoundingClientRect()\n        }, function () {\n          _this.startTargetPositionListener(10);\n\n          if (_this.popoverDiv.style.opacity !== '1') {\n            _this.popoverDiv.style.opacity = '1';\n          }\n        });\n      }\n    });\n  };\n\n  Popover.prototype.startTargetPositionListener = function (checkInterval) {\n    var _this = this;\n\n    if (this.targetPositionIntervalHandler === null) {\n      this.targetPositionIntervalHandler = window.setInterval(function () {\n        var newTargetRect = _this.target.getBoundingClientRect();\n\n        if (_this.targetPositionHasChanged(_this.targetRect, newTargetRect)) {\n          _this.renderPopover();\n        }\n\n        _this.targetRect = newTargetRect;\n      }, checkInterval);\n    }\n  };\n\n  Popover.prototype.renderWithPosition = function (_a, callback) {\n    var _this = this;\n\n    var position = _a.position,\n        _b = _a.nudgedLeft,\n        nudgedLeft = _b === void 0 ? 0 : _b,\n        _c = _a.nudgedTop,\n        nudgedTop = _c === void 0 ? 0 : _c,\n        _d = _a.targetRect,\n        targetRect = _d === void 0 ? util_1.Constants.EMPTY_CLIENT_RECT : _d,\n        _e = _a.popoverRect,\n        popoverRect = _e === void 0 ? util_1.Constants.EMPTY_CLIENT_RECT : _e;\n    var _f = this.props,\n        padding = _f.windowBorderPadding,\n        content = _f.content,\n        align = _f.align;\n    var popoverInfo = {\n      position: position,\n      nudgedLeft: nudgedLeft,\n      nudgedTop: nudgedTop,\n      targetRect: targetRect,\n      popoverRect: popoverRect,\n      align: align\n    };\n\n    if (!underscore_1.isEqual(this.state.popoverInfo, popoverInfo)) {\n      this.setState({\n        popoverInfo: popoverInfo\n      }, function () {\n        if (_this.willUnmount) {\n          return;\n        }\n\n        targetRect = _this.target.getBoundingClientRect();\n        popoverRect = _this.popoverDiv.getBoundingClientRect();\n\n        var _a = _this.getLocationForPosition(position, targetRect, popoverRect),\n            top = _a.top,\n            left = _a.left;\n\n        callback(position === 'top' && top < padding || position === 'left' && left < padding || position === 'right' && left + popoverRect.width > window.innerWidth - padding || position === 'bottom' && top + popoverRect.height > window.innerHeight - padding, {\n          width: popoverRect.width,\n          height: popoverRect.height,\n          top: top,\n          left: left\n        });\n      });\n    }\n  };\n\n  Popover.prototype.getNudgedPopoverPosition = function (_a) {\n    var top = _a.top,\n        left = _a.left,\n        width = _a.width,\n        height = _a.height;\n    var padding = this.props.windowBorderPadding;\n    top = top < padding ? padding : top;\n    top = top + height > window.innerHeight - padding ? window.innerHeight - padding - height : top;\n    left = left < padding ? padding : left;\n    left = left + width > window.innerWidth - padding ? window.innerWidth - padding - width : left;\n    return {\n      top: top,\n      left: left\n    };\n  };\n\n  Popover.prototype.removePopover = function () {\n    var _this = this;\n\n    if (this.popoverDiv) {\n      var transitionDuration = this.props.transitionDuration;\n      this.popoverDiv.style.opacity = '0';\n\n      var remove = function () {\n        if (_this.willUnmount || !_this.props.isOpen || !_this.popoverDiv.parentNode) {\n          window.clearInterval(_this.targetPositionIntervalHandler);\n          window.removeEventListener('resize', _this.onResize);\n          window.removeEventListener('click', _this.onClick);\n          _this.targetPositionIntervalHandler = null;\n        }\n      };\n\n      if (!this.willUnmount) {\n        window.setTimeout(remove, (transitionDuration || util_1.Constants.FADE_TRANSITION) * 1000);\n      } else {\n        remove();\n      }\n    }\n  };\n\n  Popover.prototype.getPositionPriorityOrder = function (position) {\n    if (position && typeof position !== 'string') {\n      if (util_1.Constants.DEFAULT_POSITIONS.every(function (defaultPosition) {\n        return position.find(function (p) {\n          return p === defaultPosition;\n        }) !== undefined;\n      })) {\n        return util_1.arrayUnique(position);\n      } else {\n        var remainingPositions = util_1.Constants.DEFAULT_POSITIONS.filter(function (defaultPosition) {\n          return position.find(function (p) {\n            return p === defaultPosition;\n          }) === undefined;\n        });\n        return util_1.arrayUnique(position.concat(remainingPositions));\n      }\n    } else if (position && typeof position === 'string') {\n      var remainingPositions = util_1.Constants.DEFAULT_POSITIONS.filter(function (defaultPosition) {\n        return defaultPosition !== position;\n      });\n      return util_1.arrayUnique([position].concat(remainingPositions));\n    }\n  };\n\n  Popover.prototype.createContainer = function () {\n    var _a = this.props,\n        containerStyle = _a.containerStyle,\n        containerClassName = _a.containerClassName;\n    var container = window.document.createElement('div');\n    container.style.overflow = 'hidden';\n\n    if (containerStyle) {\n      Object.keys(containerStyle).forEach(function (key) {\n        return container.style[key] = containerStyle[key];\n      });\n    }\n\n    container.className = containerClassName;\n    container.style.position = 'absolute';\n    container.style.top = '0';\n    container.style.left = '0';\n    return container;\n  };\n\n  Popover.prototype.getLocationForPosition = function (position, newTargetRect, popoverRect) {\n    var _a = this.props,\n        padding = _a.padding,\n        align = _a.align;\n    var targetMidX = newTargetRect.left + newTargetRect.width / 2;\n    var targetMidY = newTargetRect.top + newTargetRect.height / 2;\n    var top;\n    var left;\n\n    switch (position) {\n      case 'top':\n        top = newTargetRect.top - popoverRect.height - padding;\n        left = targetMidX - popoverRect.width / 2;\n\n        if (align === 'start') {\n          left = newTargetRect.left;\n        }\n\n        if (align === 'end') {\n          left = newTargetRect.right - popoverRect.width;\n        }\n\n        break;\n\n      case 'left':\n        top = targetMidY - popoverRect.height / 2;\n        left = newTargetRect.left - padding - popoverRect.width;\n\n        if (align === 'start') {\n          top = newTargetRect.top;\n        }\n\n        if (align === 'end') {\n          top = newTargetRect.bottom - popoverRect.height;\n        }\n\n        break;\n\n      case 'bottom':\n        top = newTargetRect.bottom + padding;\n        left = targetMidX - popoverRect.width / 2;\n\n        if (align === 'start') {\n          left = newTargetRect.left;\n        }\n\n        if (align === 'end') {\n          left = newTargetRect.right - popoverRect.width;\n        }\n\n        break;\n\n      case 'right':\n        top = targetMidY - popoverRect.height / 2;\n        left = newTargetRect.right + padding;\n\n        if (align === 'start') {\n          top = newTargetRect.top;\n        }\n\n        if (align === 'end') {\n          top = newTargetRect.bottom - popoverRect.height;\n        }\n\n        break;\n    }\n\n    return {\n      top: top,\n      left: left\n    };\n  };\n\n  Popover.prototype.targetPositionHasChanged = function (oldTargetRect, newTargetRect) {\n    return oldTargetRect === null || oldTargetRect.left !== newTargetRect.left || oldTargetRect.top !== newTargetRect.top || oldTargetRect.width !== newTargetRect.width || oldTargetRect.height !== newTargetRect.height;\n  };\n\n  Popover.defaultProps = {\n    padding: util_1.Constants.DEFAULT_PADDING,\n    windowBorderPadding: util_1.Constants.DEFAULT_WINDOW_PADDING,\n    position: ['top', 'right', 'left', 'bottom'],\n    align: 'center',\n    containerClassName: util_1.Constants.POPOVER_CONTAINER_CLASS_NAME\n  };\n  return Popover;\n}(React.Component);\n\nexports.default = Popover;","map":{"version":3,"sources":["../src/Popover.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar react_dom_1 = require(\"react-dom\");\nvar util_1 = require(\"./util\");\nvar ArrowContainer_1 = require(\"./ArrowContainer\");\nexports.ArrowContainer = ArrowContainer_1.ArrowContainer;\nvar Portal_1 = require(\"./Portal\");\nvar underscore_1 = require(\"underscore\");\nvar Popover = /** @class */ (function (_super) {\n    __extends(Popover, _super);\n    function Popover(props) {\n        var _this = _super.call(this, props) || this;\n        _this.target = null;\n        _this.targetRect = null;\n        _this.targetPositionIntervalHandler = null;\n        _this.popoverDiv = null;\n        _this.positionOrder = null;\n        _this.willUnmount = false;\n        _this.willMount = false;\n        _this.onResize = function (e) {\n            _this.renderPopover();\n        };\n        _this.onClick = function (e) {\n            var _a = _this.props, onClickOutside = _a.onClickOutside, isOpen = _a.isOpen;\n            if (!_this.willUnmount && !_this.willMount && !_this.popoverDiv.contains(e.target) && !_this.target.contains(e.target) && onClickOutside && isOpen) {\n                onClickOutside(e);\n            }\n        };\n        _this.state = {\n            popoverInfo: null,\n        };\n        _this.willUnmount = false;\n        _this.willMount = true;\n        return _this;\n    }\n    Popover.prototype.componentDidMount = function () {\n        var _this = this;\n        window.setTimeout(function () { return _this.willMount = false; });\n        var _a = this.props, position = _a.position, isOpen = _a.isOpen;\n        this.target = react_dom_1.findDOMNode(this);\n        this.positionOrder = this.getPositionPriorityOrder(position);\n        this.updatePopover(isOpen);\n    };\n    Popover.prototype.componentDidUpdate = function (prevProps) {\n        if (this.target == null) {\n            this.target = react_dom_1.findDOMNode(this);\n        }\n        var prevIsOpen = prevProps.isOpen, prevPosition = prevProps.position, prevBody = prevProps.content;\n        var _a = this.props, isOpen = _a.isOpen, content = _a.content, position = _a.position;\n        this.positionOrder = this.getPositionPriorityOrder(this.props.position);\n        var hasNewDestination = prevProps.contentDestination !== this.props.contentDestination;\n        if (prevIsOpen !== isOpen ||\n            prevBody !== content ||\n            prevPosition !== position ||\n            hasNewDestination) {\n            if (hasNewDestination) {\n                this.removePopover();\n                this.popoverDiv && this.popoverDiv.remove();\n            }\n            this.updatePopover(isOpen);\n        }\n    };\n    Popover.prototype.componentWillUnmount = function () {\n        this.willUnmount = true;\n        this.removePopover();\n    };\n    Popover.prototype.render = function () {\n        var content = this.props.content;\n        var popoverInfo = this.state.popoverInfo;\n        var popoverContent = null;\n        if (this.props.isOpen && this.popoverDiv && popoverInfo) {\n            var getContent = function (args) {\n                return typeof content === 'function'\n                    ? content(args)\n                    : content;\n            };\n            popoverContent = React.createElement(Portal_1.Portal, { element: this.popoverDiv, container: this.props.contentDestination || window.document.body }, getContent(popoverInfo));\n        }\n        return (React.createElement(React.Fragment, null,\n            this.props.children,\n            popoverContent));\n    };\n    Popover.prototype.updatePopover = function (isOpen) {\n        if (isOpen && this.target != null) {\n            if (!this.popoverDiv || !this.popoverDiv.parentNode) {\n                var transitionDuration = this.props.transitionDuration;\n                this.popoverDiv = this.createContainer();\n                this.popoverDiv.style.opacity = '0';\n                this.popoverDiv.style.transition = \"opacity \" + (transitionDuration || util_1.Constants.FADE_TRANSITION) + \"s\";\n            }\n            window.addEventListener('resize', this.onResize);\n            window.addEventListener('click', this.onClick);\n            this.renderPopover();\n        }\n        else if (this.popoverDiv && this.popoverDiv.parentNode) {\n            this.removePopover();\n        }\n    };\n    Popover.prototype.renderPopover = function (positionIndex) {\n        var _this = this;\n        if (positionIndex === void 0) { positionIndex = 0; }\n        if (positionIndex >= this.positionOrder.length) {\n            this.removePopover();\n            return;\n        }\n        this.renderWithPosition({ position: this.positionOrder[positionIndex], targetRect: this.target.getBoundingClientRect() }, function (violation, rect) {\n            var _a;\n            var _b = _this.props, disableReposition = _b.disableReposition, contentLocation = _b.contentLocation;\n            if (violation && !disableReposition && !(typeof contentLocation === 'object')) {\n                _this.renderPopover(positionIndex + 1);\n            }\n            else {\n                var _c = _this.props, contentLocation_1 = _c.contentLocation, align = _c.align;\n                var _d = _this.getNudgedPopoverPosition(rect), nudgedTop = _d.top, nudgedLeft = _d.left;\n                var rectTop = rect.top, rectLeft = rect.left;\n                var position = _this.positionOrder[positionIndex];\n                var _e = disableReposition ? { top: rectTop, left: rectLeft } : { top: nudgedTop, left: nudgedLeft }, top_1 = _e.top, left = _e.left;\n                if (contentLocation_1) {\n                    var targetRect = _this.target.getBoundingClientRect();\n                    var popoverRect = _this.popoverDiv.getBoundingClientRect();\n                    (_a = typeof contentLocation_1 === 'function' ? contentLocation_1({ targetRect: targetRect, popoverRect: popoverRect, position: position, align: align, nudgedLeft: nudgedLeft, nudgedTop: nudgedTop }) : contentLocation_1, top_1 = _a.top, left = _a.left);\n                    _this.popoverDiv.style.left = left.toFixed() + \"px\";\n                    _this.popoverDiv.style.top = top_1.toFixed() + \"px\";\n                }\n                else {\n                    var destinationTopOffset = 0;\n                    var destinationLeftOffset = 0;\n                    if (_this.props.contentDestination) {\n                        var destRect = _this.props.contentDestination.getBoundingClientRect();\n                        destinationTopOffset = -destRect.top;\n                        destinationLeftOffset = -destRect.left;\n                    }\n                    var _f = [top_1 + window.pageYOffset, left + window.pageXOffset], absoluteTop = _f[0], absoluteLeft = _f[1];\n                    var finalLeft = absoluteLeft + destinationTopOffset;\n                    var finalTop = absoluteTop + destinationLeftOffset;\n                    _this.popoverDiv.style.left = finalLeft.toFixed() + \"px\";\n                    _this.popoverDiv.style.top = finalTop.toFixed() + \"px\";\n                }\n                _this.popoverDiv.style.width = null;\n                _this.popoverDiv.style.height = null;\n                _this.renderWithPosition({\n                    position: position,\n                    nudgedTop: nudgedTop - rect.top,\n                    nudgedLeft: nudgedLeft - rect.left,\n                    targetRect: _this.target.getBoundingClientRect(),\n                    popoverRect: _this.popoverDiv.getBoundingClientRect(),\n                }, function () {\n                    _this.startTargetPositionListener(10);\n                    if (_this.popoverDiv.style.opacity !== '1') {\n                        _this.popoverDiv.style.opacity = '1';\n                    }\n                });\n            }\n        });\n    };\n    Popover.prototype.startTargetPositionListener = function (checkInterval) {\n        var _this = this;\n        if (this.targetPositionIntervalHandler === null) {\n            this.targetPositionIntervalHandler = window.setInterval(function () {\n                var newTargetRect = _this.target.getBoundingClientRect();\n                if (_this.targetPositionHasChanged(_this.targetRect, newTargetRect)) {\n                    _this.renderPopover();\n                }\n                _this.targetRect = newTargetRect;\n            }, checkInterval);\n        }\n    };\n    Popover.prototype.renderWithPosition = function (_a, callback) {\n        var _this = this;\n        var position = _a.position, _b = _a.nudgedLeft, nudgedLeft = _b === void 0 ? 0 : _b, _c = _a.nudgedTop, nudgedTop = _c === void 0 ? 0 : _c, _d = _a.targetRect, targetRect = _d === void 0 ? util_1.Constants.EMPTY_CLIENT_RECT : _d, _e = _a.popoverRect, popoverRect = _e === void 0 ? util_1.Constants.EMPTY_CLIENT_RECT : _e;\n        var _f = this.props, padding = _f.windowBorderPadding, content = _f.content, align = _f.align;\n        var popoverInfo = { position: position, nudgedLeft: nudgedLeft, nudgedTop: nudgedTop, targetRect: targetRect, popoverRect: popoverRect, align: align };\n        if (!underscore_1.isEqual(this.state.popoverInfo, popoverInfo)) {\n            this.setState({\n                popoverInfo: popoverInfo,\n            }, function () {\n                if (_this.willUnmount) {\n                    return;\n                }\n                targetRect = _this.target.getBoundingClientRect();\n                popoverRect = _this.popoverDiv.getBoundingClientRect();\n                var _a = _this.getLocationForPosition(position, targetRect, popoverRect), top = _a.top, left = _a.left;\n                callback(position === 'top' && top < padding ||\n                    position === 'left' && left < padding ||\n                    position === 'right' && left + popoverRect.width > window.innerWidth - padding ||\n                    position === 'bottom' && top + popoverRect.height > window.innerHeight - padding, { width: popoverRect.width, height: popoverRect.height, top: top, left: left });\n            });\n        }\n    };\n    Popover.prototype.getNudgedPopoverPosition = function (_a) {\n        var top = _a.top, left = _a.left, width = _a.width, height = _a.height;\n        var padding = this.props.windowBorderPadding;\n        top = top < padding ? padding : top;\n        top = top + height > window.innerHeight - padding ? window.innerHeight - padding - height : top;\n        left = left < padding ? padding : left;\n        left = left + width > window.innerWidth - padding ? window.innerWidth - padding - width : left;\n        return { top: top, left: left };\n    };\n    Popover.prototype.removePopover = function () {\n        var _this = this;\n        if (this.popoverDiv) {\n            var transitionDuration = this.props.transitionDuration;\n            this.popoverDiv.style.opacity = '0';\n            var remove = function () {\n                if (_this.willUnmount || !_this.props.isOpen || !_this.popoverDiv.parentNode) {\n                    window.clearInterval(_this.targetPositionIntervalHandler);\n                    window.removeEventListener('resize', _this.onResize);\n                    window.removeEventListener('click', _this.onClick);\n                    _this.targetPositionIntervalHandler = null;\n                }\n            };\n            if (!this.willUnmount) {\n                window.setTimeout(remove, (transitionDuration || util_1.Constants.FADE_TRANSITION) * 1000);\n            }\n            else {\n                remove();\n            }\n        }\n    };\n    Popover.prototype.getPositionPriorityOrder = function (position) {\n        if (position && typeof position !== 'string') {\n            if (util_1.Constants.DEFAULT_POSITIONS.every(function (defaultPosition) { return position.find(function (p) { return p === defaultPosition; }) !== undefined; })) {\n                return util_1.arrayUnique(position);\n            }\n            else {\n                var remainingPositions = util_1.Constants.DEFAULT_POSITIONS.filter(function (defaultPosition) { return position.find(function (p) { return p === defaultPosition; }) === undefined; });\n                return util_1.arrayUnique(position.concat(remainingPositions));\n            }\n        }\n        else if (position && typeof position === 'string') {\n            var remainingPositions = util_1.Constants.DEFAULT_POSITIONS.filter(function (defaultPosition) { return defaultPosition !== position; });\n            return util_1.arrayUnique([position].concat(remainingPositions));\n        }\n    };\n    Popover.prototype.createContainer = function () {\n        var _a = this.props, containerStyle = _a.containerStyle, containerClassName = _a.containerClassName;\n        var container = window.document.createElement('div');\n        container.style.overflow = 'hidden';\n        if (containerStyle) {\n            Object.keys(containerStyle).forEach(function (key) { return container.style[key] = containerStyle[key]; });\n        }\n        container.className = containerClassName;\n        container.style.position = 'absolute';\n        container.style.top = '0';\n        container.style.left = '0';\n        return container;\n    };\n    Popover.prototype.getLocationForPosition = function (position, newTargetRect, popoverRect) {\n        var _a = this.props, padding = _a.padding, align = _a.align;\n        var targetMidX = newTargetRect.left + (newTargetRect.width / 2);\n        var targetMidY = newTargetRect.top + (newTargetRect.height / 2);\n        var top;\n        var left;\n        switch (position) {\n            case 'top':\n                top = newTargetRect.top - popoverRect.height - padding;\n                left = targetMidX - (popoverRect.width / 2);\n                if (align === 'start') {\n                    left = newTargetRect.left;\n                }\n                if (align === 'end') {\n                    left = newTargetRect.right - popoverRect.width;\n                }\n                break;\n            case 'left':\n                top = targetMidY - (popoverRect.height / 2);\n                left = newTargetRect.left - padding - popoverRect.width;\n                if (align === 'start') {\n                    top = newTargetRect.top;\n                }\n                if (align === 'end') {\n                    top = newTargetRect.bottom - popoverRect.height;\n                }\n                break;\n            case 'bottom':\n                top = newTargetRect.bottom + padding;\n                left = targetMidX - (popoverRect.width / 2);\n                if (align === 'start') {\n                    left = newTargetRect.left;\n                }\n                if (align === 'end') {\n                    left = newTargetRect.right - popoverRect.width;\n                }\n                break;\n            case 'right':\n                top = targetMidY - (popoverRect.height / 2);\n                left = newTargetRect.right + padding;\n                if (align === 'start') {\n                    top = newTargetRect.top;\n                }\n                if (align === 'end') {\n                    top = newTargetRect.bottom - popoverRect.height;\n                }\n                break;\n        }\n        return { top: top, left: left };\n    };\n    Popover.prototype.targetPositionHasChanged = function (oldTargetRect, newTargetRect) {\n        return oldTargetRect === null\n            || oldTargetRect.left !== newTargetRect.left\n            || oldTargetRect.top !== newTargetRect.top\n            || oldTargetRect.width !== newTargetRect.width\n            || oldTargetRect.height !== newTargetRect.height;\n    };\n    Popover.defaultProps = {\n        padding: util_1.Constants.DEFAULT_PADDING,\n        windowBorderPadding: util_1.Constants.DEFAULT_WINDOW_PADDING,\n        position: ['top', 'right', 'left', 'bottom'],\n        align: 'center',\n        containerClassName: util_1.Constants.POPOVER_CONTAINER_CLASS_NAME,\n    };\n    return Popover;\n}(React.Component));\nexports.default = Popover;\n//# sourceMappingURL=Popover.js.map"]},"metadata":{},"sourceType":"script"}